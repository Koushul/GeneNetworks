{"timestamp": 1640237925.617992, "stored_source_code": "def create_mutation_matrix(upstream, product):\n\n    mutations = pd.read_parquet(str(upstream['download_mutations']))\n    mutations = mutations[(mutations['Variant_Classification'] != 'Silent')]\n    mutations = mutations[(mutations['IMPACT'] != 'LOW')]\n    mutations['Barcode'] = mutations['Tumor_Sample_Barcode'].str[:-3]\n\n    mutated_genes = pd.read_csv(MUTATED_GENES, delimiter='\\t')\n    mutated_genes['Freq'] = mutated_genes['Freq'].str[:-1].astype(float)\n\n    traits = pd.read_parquet(str(upstream['generate_traits']))\n    mutation_matrix = pd.DataFrame(columns=set(mutations['Hugo_Symbol']), index = traits.index).fillna(0)\n    for patient_id in traits.index:\n        for m in set(mutations[mutations.Barcode == patient_id]['Hugo_Symbol']):\n            mutation_matrix.loc[patient_id, m] = 1\n\n    mutation_matrix = (mutation_matrix[\n            set(mutated_genes\n                    .query('Freq > 5')\n                    .sort_values(by='Freq', ascending=False).Gene) & \n            set(mutations['Hugo_Symbol'])])\n\n    mutation_matrix.to_parquet(product)\n", "params": {}}